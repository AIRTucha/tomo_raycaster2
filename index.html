<html lang="en">
	<head>
		<title>Lidar - WebGL Volume Rendering</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<script src="./libs/three.js"></script>
		<script src="./libs/Detector.js"></script>
		<script src="./libs/OrbitControls.js"></script>
		<script src="./libs/stats.min.js"></script>

		<script src="./src/raycasterNamespace.js"></script>
		<script src="./src/delegate.js"></script>
		<script src="./src/adaptaionManager.js"></script>
		<script src="./src/GeometryHelper.js"></script>
		<script src="./src/shaders.js"></script>
		<script src="./src/core.js"></script>
		<script src="./src/raycaster.js"></script>

	</head>
	<body>
		<div id="container">
		</div>

		<img id="transferFunctionImg"/>

		<script>

			var download_images = function(images_paths, one_on_load, all_on_load, on_error) {
				var downloaded_images = [];
				var downloaded_images_number = 0;

				try {
					for (var image_index = 0; image_index < images_paths.length; image_index++) {
						var image = new Image();
						(function(image, image_index) {
							image.onload = function() {
								downloaded_images[image_index] = image;
								downloaded_images_number++;
								
								one_on_load(image);
								
								if(downloaded_images_number == images_paths.length) {
									all_on_load(downloaded_images);
								};

							};

							image.src = images_paths[image_index];

						})(image, image_index);

					};
				}
				catch(e) {
					on_error(e);

				};

			};

			var images_paths = [
			// 'slicemap0.png',
			
			// 'sara_2048x2048_14x14_bl_0.jpg',
			// 'sara_2048x2048_14x14_bl_1.jpg',
			// 'sara_2048x2048_14x14_bl_2.jpg',
			// 'sara_2048x2048_14x14_bl_3.jpg',
			// 'sara_2048x2048_14x14_bl_4.jpg',
			// 'sara_2048x2048_14x14_bl_5.jpg',
			// 'sara_2048x2048_14x14_bl_6.jpg',

			// 'sara_8192x8192_19x19_bl_0.jpg',
			// 'sara_8192x8192_19x19_bl_1.jpg',
			// 'sara_8192x8192_19x19_bl_2.jpg',
			// 'sara_8192x8192_19x19_bl_3.jpg',

			'lidar_4096x4096_8x8_n_0.jpg',
			'lidar_4096x4096_8x8_n_1.jpg',
			// 'lidar_2048x2048_16x16_n_0.jpg'
			];

			textures = [];

			var one_on_load = function(img) {
				console.log(img.src);

			};

			var all_on_load = function(images) {
				console.log(images);
				window.images = images;

				rcl = new RC.RaycasterLib();

				rcl.setConfig({
					"images": images,
					"gap_slices": [0, 110],
					"gray_min": 0.1,
					"gray_max": 1.0,
					"row_col": [8, 8],
					"steps": 1024,
					// "resolution": [512, 512],
					"absorption_mode": 1,
					// "x_min": 0.4,
					// "x_max": 0.6,
					"auto_steps": true,
				});

				rcl.addOnResizeCallback(function() {
					rcl._core._camera.aspect = window.innerWidth / window.innerHeight;
					rcl._core._camera.updateProjectionMatrix();
				    rcl.setResolution(window.innerWidth, window.innerHeight);
				});

				rcl.setTransferFunction(
					[
                        {"pos": 1.0, "color": "#7F0000"},
                        {"pos": 0.75, "color": "#FF9400"},
                        {"pos": 0.5,  "color": "#7CFF79"},
                        {"pos": 0.0, "color": "#000000"},
                        {"pos": 1.0, "color": "#FFFFFF"},

                        // {"pos": 0.0, "color": "#00007F"},
                        // {"pos": 0.25, "color": "#0080FF"},
                        // {"pos": 0.5,  "color": "#7CFF79"},
                        // {"pos": 0.75, "color": "#FF9400"},
                        // {"pos": 1.0, "color": "#7F0000"},


                    ],
                    [20, 500]

    			);
			};

			var on_error = function(e) {
				console.log(e);
			};

			download_images(images_paths, one_on_load, all_on_load, on_error);

		</script>

	</body>
</html>
